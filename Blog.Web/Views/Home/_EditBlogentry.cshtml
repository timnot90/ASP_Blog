@using Blog.Web.Models.Home
@model Blog.Web.Models.Home.EditBlogentryModel
<div class="modal fade" id="editBlogentryModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            @using (Ajax.BeginForm( "_EditBlogentry", "Home", new {area = ""}, new AjaxOptions
            {
                HttpMethod = "POST",
                UpdateTargetId = "editBlogentryModal",
                InsertionMode = InsertionMode.Replace,
                //OnFailure = "handleAjaxError",
                OnSuccess = "handleAjaxSuccess", 
            } ))
            {
                @Html.HiddenFor( m => m.Id, new {id = "blogentryId"} )
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">@Html.TextBoxFor(m => m.Header, new { @class = "form-control", id = "editBlogentryModalTitle" })</h4>
                </div>
                <div class="modal-body">
                    @Html.TextAreaFor( m => m.Body, new {@class = "form-control", id = "editBlogentryModalBody"} )
                    @{
                        int i = 0;
                        foreach (CategoryModel category in Model.Categories)
                        {
                            @Html.HiddenFor( m => m.Categories[i].Id )
                            @Html.HiddenFor( m => m.Categories[i].Name )
                            <label>
                                @Model.Categories[i].Name
                                @Html.CheckBoxFor( m => m.Categories[i].IsSelected, new {@class = "checkbox-inline"} )
                            </label>
                            i++;
                        }
                        @Html.ValidationSummary()
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            }
        </div>
    </div>
</div>
<script>
    //        function OnFailure(ajaxContext) {
    //            console.log(ajaxContext);
    //            $("#editBlogentryModal").replaceWith(ajaxContext.responseText);
    //        }
    function handleAjaxSuccess(ajaxContext) {
        console.log("context: ");
        console.log(ajaxContext);
        window.location.href = "/Home/Blogentry?id=" + $("#blogentryId").val();
//        $("#Id").innerHTML.replaceWith($("#editBlogentryModalTitle").innerHTML);
//        $("#blogentryBody").innerHTML.replaceWith($("#editBlogentryModalBody").innerHTML);
//        var editBlogentryModal = $('#editBlogentryModal');
//        editBlogentryModal.modal('hide');
        //            $("#blogentryDetail").replaceWith($(ajaxContext.responseText).find('#blogentryDetail').html());
    }
</script>